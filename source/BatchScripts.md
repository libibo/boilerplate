---
title: Batch Scripts
date: 2019-10-08
tags: ["サンプル", "チュートリアル"]
excerpt: これは抜粋です。
---

Windowsコマンドプロンプトの「実際に役立つ」コマンドだけを１０個集めたもの。  
作業効率を改善する助けになるし，またいざという時に必要になるので，暗記しておくことが望ましい。  

GUIのWindows上で，あえてコマンドプロンプトを使うことの目玉は，  
- ファイル処理系
- ネットワーク系
の２分野にある。  

「ファイル処理系」のコマンドを５つ列挙する。  

（１）ファイルの一括処理：　for 文  
（２）ファイルを検索：　dir  
（３）ファイル内を検索：　findstr  
（４）ファイルの差分を検出：　fc  
（５）フォルダ構造を表示：　tree  

## （１）ファイルの一括処理：　for 文

このフォルダにある全テキストファイルを一斉に開きたい

~~~dos
for %V in ( *.txt ) do %V
~~~
解説：  
- フォルダ中で，正規表現でファイルパターンが *.txt にマッチする全ファイルを検出する。  
- 検出結果のファイル名は %V なる変数に代入される。  
- 全マッチ結果について，do 以下のコマンドが実行される。  
- ファイル名 %V を単独で実行すると，そのファイルがデフォルトアプリケーションで開かれる。  

このフォルダにある全SQLファイルを一斉に実行したい

~~~dos
for %V in ( *.sql ) do psql -d DBNAME -U USERNAME -f %V
~~~

これはPostgreSQLの例。  
パスワードは複数回入力する必要があるが，実行したいSQLは自動的に，順番に選択・実行される。  
データベース名やユーザ名を１ファイルごとに入力し直さないで済む。  

さらに，このような使い方もある。  

このフォルダ以下にある全JPGファイルを一つのフォルダ上にコピーしたい  

~~~dos
for /R %V in (*.jpg) do copy /Y "%V" d:\img\
~~~


このフォルダにある全テキストファイルを一つのファイルに結合したい

~~~dos
for %V in ( *.txt ) do copy temp.txt + %V temp.txt
~~~

解説：  
- copy /Y A B というコマンドは，同名のファイルは上書きしてコピーする事を指す。
- copy A + B C というコマンドは，AとBを結合してCの名で保存する事を指す。
- フォルダから全テキストファイルを抽出し，それぞれ %V に格納
- %V と temp.txt を毎回結合する。

前者の例では，カレントディレクトリ以下の全てのフォルダからJPGファイルを探索し，コピーする。  
（同名のファイルを上書きせずに，フォルダ構造を保ってコピーしたい場合は，　xcopy /S /H *.jpg d:\img\　とする。）  

後者のtemp.txt の中には，全テキストファイルの内容が順番に結合して保存される。  
（※多少，余計な情報が混入する可能性もあるので注意。）  
「ためておいた細切れのメモを，いっぺんに印刷したい！」というような時に役立つだろう。  

