---
title: BATファイルの書き方・パターン集
date: 2019-10-08
tags: ["サンプル", "チュートリアル"]
excerpt: これは抜粋です。
---

## （０）BATプログラミングの特徴

BATのメリット：  
- ファイルシステムの一括処理に便利  
- プロセスの起動処理を簡素化できる（起動引数などをまとめて保管しておける）  

BATのデメリット：  
- 構造型プログラムが書けない，極めて書きづらい   
 →本エントリで，各種の構文を理解すべし。サブルーチンやfor文の使いようがキモ。  
- 複雑な処理は困難   
 →別のプログラムを呼び出して処理させるべし。cscriptでWSF・WSHを呼び出すのもよし。mshtaでワンライナーを記述するのもよし。  

BATでできない難しいことを，無理やりBATでコーディングする必要はない。  

BATの「得意分野」はBATでコーディングし，なおかつ，BATの「守備範囲外」の事柄であれば，BATから別のプログラムを呼び出せばよいのだ。  

BATはプログラムの起動が得意なのだから，多いに外部プログラムに頼って良いのだ。  
むしろ，「外部プログラムの呼び出し方」を，順番にうまく制御する役目を担うのがBATである。  

## （１）BATファイルの雛型

### （１−１）冒頭と末尾のテンプレート
BATの最初と最後に記述する内容は，だいたい決まっている。  
冒頭と末尾は，便利なので暗記してしまおう。  

~~~dos
@echo off

rem
rem このバッチの説明
rem

rem 設定事項
set HOGE="変数の値"

rem このバッチが存在するフォルダをカレントに
pushd %0\..
cls


〜処理〜


pause
exit
~~~

まず冒頭の説明。
- コマンドの先頭に@をつければ，バッチ実行時に，そのコマンド自体は表示されなくなる。
- echo offとすれば，実行しているコマンド自体の表示を全面的にOFFにできる。  
  →全ての行の先頭に「@」と書かなくて済む。
- remはコメント行。冒頭には，バッチの目的などを記載する。各行では，各行の処理内容を説明する。
- setは，環境変数の定義。フォルダのパスとかを定義する。あとから変更しやすいよう，バッチの先頭部分にまとめて記述する。
- pushdは，ディレクトリの移動。 
  - cdコマンドだと，異なるドライブに移動できない。
  - cd /dとすれば，異なるドライブに移動できるが，UNCパス上でネットワークの共有フォルダ上を移動できない。
  - pushdは，ドライブの違いや，ネットワークの違いを気にせず，必ず移動できる。
  - したがって，cdではなく，常にpushdコマンドを使うのが無難。なぜなら，このバッチがどこで実行されるのか，前もって知ることができないから。
- %0 は，このバッチファイルのファイルパス。 
  - %0\.. とすれば，このバッチファイルが存在するフォルダを指す。
  - したがって，バッチの存在ずるフォルダをカレントディレクトリにすることができる。
- clsは，画面の消去。前回のコマンドの実行結果などを削除して，まっさらな画面でバッチの実行を開始できる。

ここまでで１セットである，と考えよう。

次に，バッチの末尾の説明。  

- pauseコマンドは，何かキーを押すまで待機する。バッチの終了を目視でよく確認した上で，次に進む事ができる。 
  - 突然ウィンドウが消えてしまうと，処理が成功したのか，失敗したのか，知ることができないから。
- exitでバッチの終了。




